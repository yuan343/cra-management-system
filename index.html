<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRA管理系统 - 可编辑版</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: -apple-system, 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        h1 {
            text-align: center;
            color: #667eea;
            margin-bottom: 30px;
        }
        .nav {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        .nav button {
            padding: 12px 24px;
            border: 2px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
        }
        .nav button.active {
            background: #667eea;
            color: white;
        }
        .section { display: none; }
        .section.active { display: block; }
        .card {
            background: #f8f9ff;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        th {
            background: #667eea;
            color: white;
            padding: 12px;
            text-align: left;
        }
        td {
            padding: 10px;
            border-bottom: 1px solid #e0e0e0;
        }
        .btn {
            padding: 10px 20px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            margin: 5px;
        }
        .btn:hover {
            background: #764ba2;
        }
        .btn-danger {
            background: #dc3545;
        }
        .btn-success {
            background: #28a745;
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
        }
        .modal-content {
            background: white;
            margin: 10% auto;
            padding: 30px;
            width: 80%;
            max-width: 500px;
            border-radius: 15px;
        }
        .close {
            float: right;
            font-size: 28px;
            cursor: pointer;
            color: #999;
        }
        .close:hover {
            color: #333;
        }
        input, select {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .form-group {
            margin: 15px 0;
        }
        label {
            font-weight: bold;
            color: #333;
        }
        .alert {
            padding: 15px;
            background: #d4f4dd;
            color: #28a745;
            border-radius: 10px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🏥 CRA管理系统（本地存储版）</h1>
        
        <div class="nav">
            <button class="active" onclick="showSection('team')">👥 团队管理</button>
            <button onclick="showSection('project')">📋 项目管理</button>
            <button onclick="showSection('export')">💾 数据导出</button>
        </div>

        <!-- 团队管理 -->
        <div id="team" class="section active">
            <div class="card">
                <h3>CRA团队列表</h3>
                <button class="btn btn-success" onclick="openAddModal()">+ 添加新CRA</button>
                <button class="btn" onclick="exportData()">📥 导出数据</button>
                <button class="btn" onclick="importData()">📤 导入数据</button>
                
                <table id="craTable">
                    <thead>
                        <tr>
                            <th>姓名</th>
                            <th>级别</th>
                            <th>负责中心数</th>
                            <th>电话</th>
                            <th>邮箱</th>
                            <th>操作</th>
                        </tr>
                    </thead>
                    <tbody id="craTableBody">
                        <!-- 动态生成 -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- 项目管理 -->
        <div id="project" class="section">
            <div class="card">
                <h3>项目列表</h3>
                <button class="btn btn-success" onclick="openProjectModal()">+ 添加新项目</button>
                
                <table id="projectTable">
                    <thead>
                        <tr>
                            <th>项目编号</th>
                            <th>项目名称</th>
                            <th>负责CRA</th>
                            <th>状态</th>
                            <th>开始日期</th>
                            <th>操作</th>
                        </tr>
                    </thead>
                    <tbody id="projectTableBody">
                        <!-- 动态生成 -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- 数据导出 -->
        <div id="export" class="section">
            <div class="card">
                <h3>数据管理</h3>
                <div class="alert">
                    💡 所有数据保存在浏览器本地，清除浏览器缓存会丢失数据。建议定期导出备份。
                </div>
                
                <button class="btn btn-success" onclick="exportAllData()">
                    📥 导出所有数据为JSON文件
                </button>
                
                <button class="btn" onclick="exportToExcel()">
                    📊 导出为Excel格式
                </button>
                
                <button class="btn" onclick="printReport()">
                    🖨️ 打印报表
                </button>
                
                <hr style="margin: 20px 0;">
                
                <h4>导入数据</h4>
                <input type="file" id="fileInput" accept=".json">
                <button class="btn" onclick="importFromFile()">导入JSON文件</button>
                
                <hr style="margin: 20px 0;">
                
                <h4>数据统计</h4>
                <p>CRA总数：<span id="craCount">0</span></p>
                <p>项目总数：<span id="projectCount">0</span></p>
                <p>最后更新：<span id="lastUpdate">-</span></p>
            </div>
        </div>
    </div>

    <!-- 添加CRA模态框 -->
    <div id="addModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h2>添加新CRA</h2>
            <form id="craForm">
                <div class="form-group">
                    <label>姓名：</label>
                    <input type="text" id="craName" required>
                </div>
                <div class="form-group">
                    <label>级别：</label>
                    <select id="craLevel">
                        <option>Junior CRA</option>
                        <option>CRA I</option>
                        <option>CRA II</option>
                        <option>Senior CRA</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>负责中心数：</label>
                    <input type="number" id="craCenters" min="0" value="0">
                </div>
                <div class="form-group">
                    <label>电话：</label>
                    <input type="tel" id="craPhone">
                </div>
                <div class="form-group">
                    <label>邮箱：</label>
                    <input type="email" id="craEmail">
                </div>
                <button type="button" class="btn btn-success" onclick="saveCRA()">保存</button>
                <button type="button" class="btn" onclick="closeModal()">取消</button>
            </form>
        </div>
    </div>

    <!-- 添加项目模态框 -->
    <div id="projectModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeProjectModal()">&times;</span>
            <h2>添加新项目</h2>
            <form id="projectForm">
                <div class="form-group">
                    <label>项目编号：</label>
                    <input type="text" id="projectCode" required>
                </div>
                <div class="form-group">
                    <label>项目名称：</label>
                    <input type="text" id="projectName" required>
                </div>
                <div class="form-group">
                    <label>负责CRA：</label>
                    <select id="projectCRA">
                        <!-- 动态生成 -->
                    </select>
                </div>
                <div class="form-group">
                    <label>状态：</label>
                    <select id="projectStatus">
                        <option>准备中</option>
                        <option>进行中</option>
                        <option>已完成</option>
                        <option>暂停</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>开始日期：</label>
                    <input type="date" id="projectDate">
                </div>
                <button type="button" class="btn btn-success" onclick="saveProject()">保存</button>
                <button type="button" class="btn" onclick="closeProjectModal()">取消</button>
            </form>
        </div>
    </div>

    <script>
        // 初始化数据存储
        let craData = JSON.parse(localStorage.getItem('craData')) || [];
        let projectData = JSON.parse(localStorage.getItem('projectData')) || [];

        // 页面加载时初始化
        window.onload = function() {
            loadCRATable();
            loadProjectTable();
            updateStats();
        };

        // 显示不同部分
        function showSection(id) {
            const sections = document.querySelectorAll('.section');
            sections.forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            
            const buttons = document.querySelectorAll('.nav button');
            buttons.forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
        }

        // 打开添加CRA模态框
        function openAddModal() {
            document.getElementById('addModal').style.display = 'block';
        }

        // 关闭模态框
        function closeModal() {
            document.getElementById('addModal').style.display = 'none';
            document.getElementById('craForm').reset();
        }

        // 保存CRA
        function saveCRA() {
            const cra = {
                id: Date.now(),
                name: document.getElementById('craName').value,
                level: document.getElementById('craLevel').value,
                centers: document.getElementById('craCenters').value,
                phone: document.getElementById('craPhone').value,
                email: document.getElementById('craEmail').value
            };
            
            craData.push(cra);
            localStorage.setItem('craData', JSON.stringify(craData));
            localStorage.setItem('lastUpdate', new Date().toLocaleString());
            
            loadCRATable();
            updateStats();
            closeModal();
            alert('CRA添加成功！');
        }

        // 加载CRA表格
        function loadCRATable() {
            const tbody = document.getElementById('craTableBody');
            tbody.innerHTML = '';
            
            craData.forEach(cra => {
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${cra.name}</td>
                    <td>${cra.level}</td>
                    <td>${cra.centers}</td>
                    <td>${cra.phone}</td>
                    <td>${cra.email}</td>
                    <td>
                        <button class="btn btn-danger" onclick="deleteCRA(${cra.id})">删除</button>
                    </td>
                `;
            });
        }

        // 删除CRA
        function deleteCRA(id) {
            if(confirm('确定要删除吗？')) {
                craData = craData.filter(cra => cra.id !== id);
                localStorage.setItem('craData', JSON.stringify(craData));
                loadCRATable();
                updateStats();
            }
        }

        // 项目管理功能
        function openProjectModal() {
            // 更新CRA选择列表
            const select = document.getElementById('projectCRA');
            select.innerHTML = '<option>未分配</option>';
            craData.forEach(cra => {
                select.innerHTML += `<option>${cra.name}</option>`;
            });
            document.getElementById('projectModal').style.display = 'block';
        }

        function closeProjectModal() {
            document.getElementById('projectModal').style.display = 'none';
            document.getElementById('projectForm').reset();
        }

        function saveProject() {
            const project = {
                id: Date.now(),
                code: document.getElementById('projectCode').value,
                name: document.getElementById('projectName').value,
                cra: document.getElementById('projectCRA').value,
                status: document.getElementById('projectStatus').value,
                date: document.getElementById('projectDate').value
            };
            
            projectData.push(project);
            localStorage.setItem('projectData', JSON.stringify(projectData));
            
            loadProjectTable();
            updateStats();
            closeProjectModal();
            alert('项目添加成功！');
        }

        function loadProjectTable() {
            const tbody = document.getElementById('projectTableBody');
            tbody.innerHTML = '';
            
            projectData.forEach(project => {
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${project.code}</td>
                    <td>${project.name}</td>
                    <td>${project.cra}</td>
                    <td>${project.status}</td>
                    <td>${project.date}</td>
                    <td>
                        <button class="btn btn-danger" onclick="deleteProject(${project.id})">删除</button>
                    </td>
                `;
            });
        }

        function deleteProject(id) {
            if(confirm('确定要删除吗？')) {
                projectData = projectData.filter(p => p.id !== id);
                localStorage.setItem('projectData', JSON.stringify(projectData));
                loadProjectTable();
                updateStats();
            }
        }

        // 导出功能
        function exportAllData() {
            const data = {
                craData: craData,
                projectData: projectData,
                exportDate: new Date().toLocaleString()
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `CRA_Data_${new Date().getTime()}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
        }

        // 导出为Excel（CSV格式）
        function exportToExcel() {
            let csv = 'CRA数据\n';
            csv += '姓名,级别,负责中心数,电话,邮箱\n';
            craData.forEach(cra => {
                csv += `${cra.name},${cra.level},${cra.centers},${cra.phone},${cra.email}\n`;
            });
            
            csv += '\n项目数据\n';
            csv += '项目编号,项目名称,负责CRA,状态,开始日期\n';
            projectData.forEach(project => {
                csv += `${project.code},${project.name},${project.cra},${project.status},${project.date}\n`;
            });
            
            const blob = new Blob(['\ufeff' + csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `CRA_Report_${new Date().getTime()}.csv`;
            link.click();
        }

        // 导入数据
        function importFromFile() {
            const fileInput = document.getElementById('fileInput');
            const file = fileInput.files[0];
            
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const data = JSON.parse(e.target.result);
                        craData = data.craData || [];
                        projectData = data.projectData || [];
                        
                        localStorage.setItem('craData', JSON.stringify(craData));
                        localStorage.setItem('projectData', JSON.stringify(projectData));
                        
                        loadCRATable();
                        loadProjectTable();
                        updateStats();
                        
                        alert('数据导入成功！');
                    } catch (error) {
                        alert('导入失败，请检查文件格式');
                    }
                };
                reader.readAsText(file);
            }
        }

        // 更新统计
        function updateStats() {
            document.getElementById('craCount').textContent = craData.length;
            document.getElementById('projectCount').textContent = projectData.length;
            document.getElementById('lastUpdate').textContent = localStorage.getItem('lastUpdate') || '从未';
        }

        // 打印功能
        function printReport() {
            window.print();
        }
    </script>
</body>
</html>

