<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRAç®¡ç†ç³»ç»Ÿ - å¯ç¼–è¾‘ç‰ˆ</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: -apple-system, 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        h1 {
            text-align: center;
            color: #667eea;
            margin-bottom: 30px;
        }
        .nav {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        .nav button {
            padding: 12px 24px;
            border: 2px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
        }
        .nav button.active {
            background: #667eea;
            color: white;
        }
        .section { display: none; }
        .section.active { display: block; }
        .card {
            background: #f8f9ff;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        th {
            background: #667eea;
            color: white;
            padding: 12px;
            text-align: left;
        }
        td {
            padding: 10px;
            border-bottom: 1px solid #e0e0e0;
        }
        .btn {
            padding: 10px 20px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            margin: 5px;
        }
        .btn:hover {
            background: #764ba2;
        }
        .btn-danger {
            background: #dc3545;
        }
        .btn-success {
            background: #28a745;
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
        }
        .modal-content {
            background: white;
            margin: 10% auto;
            padding: 30px;
            width: 80%;
            max-width: 500px;
            border-radius: 15px;
        }
        .close {
            float: right;
            font-size: 28px;
            cursor: pointer;
            color: #999;
        }
        .close:hover {
            color: #333;
        }
        input, select {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .form-group {
            margin: 15px 0;
        }
        label {
            font-weight: bold;
            color: #333;
        }
        .alert {
            padding: 15px;
            background: #d4f4dd;
            color: #28a745;
            border-radius: 10px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¥ CRAç®¡ç†ç³»ç»Ÿï¼ˆæœ¬åœ°å­˜å‚¨ç‰ˆï¼‰</h1>
        
        <div class="nav">
            <button class="active" onclick="showSection('team')">ğŸ‘¥ å›¢é˜Ÿç®¡ç†</button>
            <button onclick="showSection('project')">ğŸ“‹ é¡¹ç›®ç®¡ç†</button>
            <button onclick="showSection('export')">ğŸ’¾ æ•°æ®å¯¼å‡º</button>
        </div>

        <!-- å›¢é˜Ÿç®¡ç† -->
        <div id="team" class="section active">
            <div class="card">
                <h3>CRAå›¢é˜Ÿåˆ—è¡¨</h3>
                <button class="btn btn-success" onclick="openAddModal()">+ æ·»åŠ æ–°CRA</button>
                <button class="btn" onclick="exportData()">ğŸ“¥ å¯¼å‡ºæ•°æ®</button>
                <button class="btn" onclick="importData()">ğŸ“¤ å¯¼å…¥æ•°æ®</button>
                
                <table id="craTable">
                    <thead>
                        <tr>
                            <th>å§“å</th>
                            <th>çº§åˆ«</th>
                            <th>è´Ÿè´£ä¸­å¿ƒæ•°</th>
                            <th>ç”µè¯</th>
                            <th>é‚®ç®±</th>
                            <th>æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody id="craTableBody">
                        <!-- åŠ¨æ€ç”Ÿæˆ -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- é¡¹ç›®ç®¡ç† -->
        <div id="project" class="section">
            <div class="card">
                <h3>é¡¹ç›®åˆ—è¡¨</h3>
                <button class="btn btn-success" onclick="openProjectModal()">+ æ·»åŠ æ–°é¡¹ç›®</button>
                
                <table id="projectTable">
                    <thead>
                        <tr>
                            <th>é¡¹ç›®ç¼–å·</th>
                            <th>é¡¹ç›®åç§°</th>
                            <th>è´Ÿè´£CRA</th>
                            <th>çŠ¶æ€</th>
                            <th>å¼€å§‹æ—¥æœŸ</th>
                            <th>æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody id="projectTableBody">
                        <!-- åŠ¨æ€ç”Ÿæˆ -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- æ•°æ®å¯¼å‡º -->
        <div id="export" class="section">
            <div class="card">
                <h3>æ•°æ®ç®¡ç†</h3>
                <div class="alert">
                    ğŸ’¡ æ‰€æœ‰æ•°æ®ä¿å­˜åœ¨æµè§ˆå™¨æœ¬åœ°ï¼Œæ¸…é™¤æµè§ˆå™¨ç¼“å­˜ä¼šä¸¢å¤±æ•°æ®ã€‚å»ºè®®å®šæœŸå¯¼å‡ºå¤‡ä»½ã€‚
                </div>
                
                <button class="btn btn-success" onclick="exportAllData()">
                    ğŸ“¥ å¯¼å‡ºæ‰€æœ‰æ•°æ®ä¸ºJSONæ–‡ä»¶
                </button>
                
                <button class="btn" onclick="exportToExcel()">
                    ğŸ“Š å¯¼å‡ºä¸ºExcelæ ¼å¼
                </button>
                
                <button class="btn" onclick="printReport()">
                    ğŸ–¨ï¸ æ‰“å°æŠ¥è¡¨
                </button>
                
                <hr style="margin: 20px 0;">
                
                <h4>å¯¼å…¥æ•°æ®</h4>
                <input type="file" id="fileInput" accept=".json">
                <button class="btn" onclick="importFromFile()">å¯¼å…¥JSONæ–‡ä»¶</button>
                
                <hr style="margin: 20px 0;">
                
                <h4>æ•°æ®ç»Ÿè®¡</h4>
                <p>CRAæ€»æ•°ï¼š<span id="craCount">0</span></p>
                <p>é¡¹ç›®æ€»æ•°ï¼š<span id="projectCount">0</span></p>
                <p>æœ€åæ›´æ–°ï¼š<span id="lastUpdate">-</span></p>
            </div>
        </div>
    </div>

    <!-- æ·»åŠ CRAæ¨¡æ€æ¡† -->
    <div id="addModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h2>æ·»åŠ æ–°CRA</h2>
            <form id="craForm">
                <div class="form-group">
                    <label>å§“åï¼š</label>
                    <input type="text" id="craName" required>
                </div>
                <div class="form-group">
                    <label>çº§åˆ«ï¼š</label>
                    <select id="craLevel">
                        <option>Junior CRA</option>
                        <option>CRA I</option>
                        <option>CRA II</option>
                        <option>Senior CRA</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>è´Ÿè´£ä¸­å¿ƒæ•°ï¼š</label>
                    <input type="number" id="craCenters" min="0" value="0">
                </div>
                <div class="form-group">
                    <label>ç”µè¯ï¼š</label>
                    <input type="tel" id="craPhone">
                </div>
                <div class="form-group">
                    <label>é‚®ç®±ï¼š</label>
                    <input type="email" id="craEmail">
                </div>
                <button type="button" class="btn btn-success" onclick="saveCRA()">ä¿å­˜</button>
                <button type="button" class="btn" onclick="closeModal()">å–æ¶ˆ</button>
            </form>
        </div>
    </div>

    <!-- æ·»åŠ é¡¹ç›®æ¨¡æ€æ¡† -->
    <div id="projectModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeProjectModal()">&times;</span>
            <h2>æ·»åŠ æ–°é¡¹ç›®</h2>
            <form id="projectForm">
                <div class="form-group">
                    <label>é¡¹ç›®ç¼–å·ï¼š</label>
                    <input type="text" id="projectCode" required>
                </div>
                <div class="form-group">
                    <label>é¡¹ç›®åç§°ï¼š</label>
                    <input type="text" id="projectName" required>
                </div>
                <div class="form-group">
                    <label>è´Ÿè´£CRAï¼š</label>
                    <select id="projectCRA">
                        <!-- åŠ¨æ€ç”Ÿæˆ -->
                    </select>
                </div>
                <div class="form-group">
                    <label>çŠ¶æ€ï¼š</label>
                    <select id="projectStatus">
                        <option>å‡†å¤‡ä¸­</option>
                        <option>è¿›è¡Œä¸­</option>
                        <option>å·²å®Œæˆ</option>
                        <option>æš‚åœ</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>å¼€å§‹æ—¥æœŸï¼š</label>
                    <input type="date" id="projectDate">
                </div>
                <button type="button" class="btn btn-success" onclick="saveProject()">ä¿å­˜</button>
                <button type="button" class="btn" onclick="closeProjectModal()">å–æ¶ˆ</button>
            </form>
        </div>
    </div>

    <script>
        // åˆå§‹åŒ–æ•°æ®å­˜å‚¨
        let craData = JSON.parse(localStorage.getItem('craData')) || [];
        let projectData = JSON.parse(localStorage.getItem('projectData')) || [];

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.onload = function() {
            loadCRATable();
            loadProjectTable();
            updateStats();
        };

        // æ˜¾ç¤ºä¸åŒéƒ¨åˆ†
        function showSection(id) {
            const sections = document.querySelectorAll('.section');
            sections.forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            
            const buttons = document.querySelectorAll('.nav button');
            buttons.forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
        }

        // æ‰“å¼€æ·»åŠ CRAæ¨¡æ€æ¡†
        function openAddModal() {
            document.getElementById('addModal').style.display = 'block';
        }

        // å…³é—­æ¨¡æ€æ¡†
        function closeModal() {
            document.getElementById('addModal').style.display = 'none';
            document.getElementById('craForm').reset();
        }

        // ä¿å­˜CRA
        function saveCRA() {
            const cra = {
                id: Date.now(),
                name: document.getElementById('craName').value,
                level: document.getElementById('craLevel').value,
                centers: document.getElementById('craCenters').value,
                phone: document.getElementById('craPhone').value,
                email: document.getElementById('craEmail').value
            };
            
            craData.push(cra);
            localStorage.setItem('craData', JSON.stringify(craData));
            localStorage.setItem('lastUpdate', new Date().toLocaleString());
            
            loadCRATable();
            updateStats();
            closeModal();
            alert('CRAæ·»åŠ æˆåŠŸï¼');
        }

        // åŠ è½½CRAè¡¨æ ¼
        function loadCRATable() {
            const tbody = document.getElementById('craTableBody');
            tbody.innerHTML = '';
            
            craData.forEach(cra => {
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${cra.name}</td>
                    <td>${cra.level}</td>
                    <td>${cra.centers}</td>
                    <td>${cra.phone}</td>
                    <td>${cra.email}</td>
                    <td>
                        <button class="btn btn-danger" onclick="deleteCRA(${cra.id})">åˆ é™¤</button>
                    </td>
                `;
            });
        }

        // åˆ é™¤CRA
        function deleteCRA(id) {
            if(confirm('ç¡®å®šè¦åˆ é™¤å—ï¼Ÿ')) {
                craData = craData.filter(cra => cra.id !== id);
                localStorage.setItem('craData', JSON.stringify(craData));
                loadCRATable();
                updateStats();
            }
        }

        // é¡¹ç›®ç®¡ç†åŠŸèƒ½
        function openProjectModal() {
            // æ›´æ–°CRAé€‰æ‹©åˆ—è¡¨
            const select = document.getElementById('projectCRA');
            select.innerHTML = '<option>æœªåˆ†é…</option>';
            craData.forEach(cra => {
                select.innerHTML += `<option>${cra.name}</option>`;
            });
            document.getElementById('projectModal').style.display = 'block';
        }

        function closeProjectModal() {
            document.getElementById('projectModal').style.display = 'none';
            document.getElementById('projectForm').reset();
        }

        function saveProject() {
            const project = {
                id: Date.now(),
                code: document.getElementById('projectCode').value,
                name: document.getElementById('projectName').value,
                cra: document.getElementById('projectCRA').value,
                status: document.getElementById('projectStatus').value,
                date: document.getElementById('projectDate').value
            };
            
            projectData.push(project);
            localStorage.setItem('projectData', JSON.stringify(projectData));
            
            loadProjectTable();
            updateStats();
            closeProjectModal();
            alert('é¡¹ç›®æ·»åŠ æˆåŠŸï¼');
        }

        function loadProjectTable() {
            const tbody = document.getElementById('projectTableBody');
            tbody.innerHTML = '';
            
            projectData.forEach(project => {
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${project.code}</td>
                    <td>${project.name}</td>
                    <td>${project.cra}</td>
                    <td>${project.status}</td>
                    <td>${project.date}</td>
                    <td>
                        <button class="btn btn-danger" onclick="deleteProject(${project.id})">åˆ é™¤</button>
                    </td>
                `;
            });
        }

        function deleteProject(id) {
            if(confirm('ç¡®å®šè¦åˆ é™¤å—ï¼Ÿ')) {
                projectData = projectData.filter(p => p.id !== id);
                localStorage.setItem('projectData', JSON.stringify(projectData));
                loadProjectTable();
                updateStats();
            }
        }

        // å¯¼å‡ºåŠŸèƒ½
        function exportAllData() {
            const data = {
                craData: craData,
                projectData: projectData,
                exportDate: new Date().toLocaleString()
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `CRA_Data_${new Date().getTime()}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
        }

        // å¯¼å‡ºä¸ºExcelï¼ˆCSVæ ¼å¼ï¼‰
        function exportToExcel() {
            let csv = 'CRAæ•°æ®\n';
            csv += 'å§“å,çº§åˆ«,è´Ÿè´£ä¸­å¿ƒæ•°,ç”µè¯,é‚®ç®±\n';
            craData.forEach(cra => {
                csv += `${cra.name},${cra.level},${cra.centers},${cra.phone},${cra.email}\n`;
            });
            
            csv += '\né¡¹ç›®æ•°æ®\n';
            csv += 'é¡¹ç›®ç¼–å·,é¡¹ç›®åç§°,è´Ÿè´£CRA,çŠ¶æ€,å¼€å§‹æ—¥æœŸ\n';
            projectData.forEach(project => {
                csv += `${project.code},${project.name},${project.cra},${project.status},${project.date}\n`;
            });
            
            const blob = new Blob(['\ufeff' + csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `CRA_Report_${new Date().getTime()}.csv`;
            link.click();
        }

        // å¯¼å…¥æ•°æ®
        function importFromFile() {
            const fileInput = document.getElementById('fileInput');
            const file = fileInput.files[0];
            
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const data = JSON.parse(e.target.result);
                        craData = data.craData || [];
                        projectData = data.projectData || [];
                        
                        localStorage.setItem('craData', JSON.stringify(craData));
                        localStorage.setItem('projectData', JSON.stringify(projectData));
                        
                        loadCRATable();
                        loadProjectTable();
                        updateStats();
                        
                        alert('æ•°æ®å¯¼å…¥æˆåŠŸï¼');
                    } catch (error) {
                        alert('å¯¼å…¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶æ ¼å¼');
                    }
                };
                reader.readAsText(file);
            }
        }

        // æ›´æ–°ç»Ÿè®¡
        function updateStats() {
            document.getElementById('craCount').textContent = craData.length;
            document.getElementById('projectCount').textContent = projectData.length;
            document.getElementById('lastUpdate').textContent = localStorage.getItem('lastUpdate') || 'ä»æœª';
        }

        // æ‰“å°åŠŸèƒ½
        function printReport() {
            window.print();
        }
    </script>
</body>
</html>

